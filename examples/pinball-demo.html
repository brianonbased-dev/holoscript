<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HoloScript Pinball Demo</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        background: #0a0a1a;
        color: #fff;
        overflow: hidden;
      }
      #container {
        width: 100vw;
        height: 100vh;
        position: relative;
      }
      #canvas {
        width: 100%;
        height: 100%;
        display: block;
      }

      #header {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        padding: 15px 25px;
        background: linear-gradient(to bottom, rgba(0, 0, 0, 0.9), transparent);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      #title {
        font-size: 24px;
        font-weight: bold;
        background: linear-gradient(90deg, #ff6b6b, #4ecdc4, #45b7d1);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }
      #subtitle {
        font-size: 12px;
        color: #888;
        margin-top: 4px;
      }

      #score-display {
        font-family: 'Courier New', monospace;
        font-size: 32px;
        font-weight: bold;
        color: #00ff88;
        text-shadow: 0 0 20px #00ff88;
      }

      #controls-panel {
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 20px;
        align-items: center;
        background: rgba(0, 0, 0, 0.8);
        padding: 15px 30px;
        border-radius: 16px;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }
      .control-key {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
      }
      .key {
        width: 60px;
        height: 50px;
        background: linear-gradient(180deg, #333, #222);
        border: 2px solid #444;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 18px;
        transition: all 0.1s;
        box-shadow: 0 4px 0 #111;
      }
      .key.active {
        background: linear-gradient(180deg, #ff6b6b, #e94560);
        border-color: #ff6b6b;
        transform: translateY(2px);
        box-shadow: 0 2px 0 #111;
      }
      .key-label {
        font-size: 11px;
        color: #888;
        text-transform: uppercase;
      }

      .divider {
        width: 1px;
        height: 40px;
        background: #333;
      }

      #launch-btn {
        background: linear-gradient(180deg, #4ecdc4, #2ecc71);
        border: none;
        border-radius: 12px;
        padding: 15px 30px;
        color: white;
        font-weight: bold;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.2s;
      }
      #launch-btn:hover {
        transform: scale(1.05);
      }
      #launch-btn:active {
        transform: scale(0.95);
      }

      #stats {
        position: absolute;
        bottom: 20px;
        right: 20px;
        background: rgba(0, 0, 0, 0.8);
        padding: 12px 16px;
        border-radius: 8px;
        font-size: 11px;
        font-family: monospace;
        color: #888;
      }

      #instructions {
        position: absolute;
        top: 80px;
        right: 20px;
        background: rgba(0, 0, 0, 0.8);
        padding: 15px 20px;
        border-radius: 12px;
        font-size: 12px;
        max-width: 200px;
      }
      #instructions h3 {
        color: #4ecdc4;
        margin-bottom: 10px;
      }
      #instructions ul {
        list-style: none;
      }
      #instructions li {
        margin: 6px 0;
        color: #aaa;
      }
      #instructions .key-hint {
        display: inline-block;
        background: #333;
        padding: 2px 8px;
        border-radius: 4px;
        font-family: monospace;
        margin-right: 6px;
      }

      #ball-count {
        position: absolute;
        top: 80px;
        left: 20px;
        background: rgba(0, 0, 0, 0.8);
        padding: 15px 20px;
        border-radius: 12px;
      }
      #ball-count h3 {
        color: #ff6b6b;
        font-size: 12px;
        margin-bottom: 8px;
      }
      .balls {
        display: flex;
        gap: 8px;
      }
      .ball-indicator {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: linear-gradient(135deg, #c0c0c0, #888);
        box-shadow: inset -2px -2px 4px rgba(0, 0, 0, 0.3);
      }
      .ball-indicator.used {
        background: #333;
        box-shadow: none;
      }
    </style>
  </head>
  <body>
    <div id="container">
      <canvas id="canvas"></canvas>

      <div id="header">
        <div>
          <div id="title">RETRO PINBALL</div>
          <div id="subtitle">Built with HoloScript</div>
        </div>
        <div id="score-display">00000</div>
      </div>

      <div id="ball-count">
        <h3>BALLS</h3>
        <div class="balls">
          <div class="ball-indicator"></div>
          <div class="ball-indicator"></div>
          <div class="ball-indicator"></div>
        </div>
      </div>

      <div id="instructions">
        <h3>HOW TO PLAY</h3>
        <ul>
          <li><span class="key-hint">A</span> Left Flipper</li>
          <li><span class="key-hint">D</span> Right Flipper</li>
          <li><span class="key-hint">SPACE</span> Launch Ball</li>
          <li><span class="key-hint">R</span> Reset Camera</li>
        </ul>
      </div>

      <div id="controls-panel">
        <div class="control-key">
          <div class="key" id="key-a">A</div>
          <span class="key-label">Left Flipper</span>
        </div>
        <div class="divider"></div>
        <button id="launch-btn">ðŸš€ LAUNCH</button>
        <div class="divider"></div>
        <div class="control-key">
          <div class="key" id="key-d">D</div>
          <span class="key-label">Right Flipper</span>
        </div>
      </div>

      <div id="stats">
        Objects: <span id="stat-objects">0</span> | FPS: <span id="stat-fps">60</span>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script>
      let scene, camera, renderer, controls;
      let objects = [],
        animatedObjects = [];
      let clock,
        score = 0,
        ballsRemaining = 3;
      let leftFlipper, rightFlipper, ball, plunger;
      let leftFlipperActive = false,
        rightFlipperActive = false;
      let ballVelocity = { x: 0, y: 0, z: 0 };
      let ballLaunched = false;
      let frameCount = 0,
        lastFpsUpdate = 0;

      const PINBALL_SCENE = `
environment {
  skybox: "night"
  ambient_light: 0.4
}

object "table_base" {
  geometry: "cube"
  color: "#1a1a2e"
  position: { x: 0, y: 0, z: 0 }
  scale: { x: 4, y: 0.2, z: 6 }
}

object "table_surface" {
  geometry: "cube"
  color: "#16213e"
  position: { x: 0, y: 0.15, z: 0 }
  scale: { x: 3.8, y: 0.05, z: 5.8 }
}

object "wall_left" {
  geometry: "cube"
  color: "#e94560"
  position: { x: -1.85, y: 0.35, z: 0 }
  scale: { x: 0.1, y: 0.4, z: 6 }
}

object "wall_right" {
  geometry: "cube"
  color: "#e94560"
  position: { x: 1.85, y: 0.35, z: 0 }
  scale: { x: 0.1, y: 0.4, z: 6 }
}

object "wall_top" {
  geometry: "cube"
  color: "#e94560"
  position: { x: 0, y: 0.35, z: -2.85 }
  scale: { x: 3.8, y: 0.4, z: 0.1 }
}

object "flipper_left" {
  geometry: "cube"
  color: "#ff6b6b"
  position: { x: -0.5, y: 0.25, z: 2.2 }
  scale: { x: 0.6, y: 0.1, z: 0.15 }
}

object "flipper_right" {
  geometry: "cube"
  color: "#ff6b6b"
  position: { x: 0.5, y: 0.25, z: 2.2 }
  scale: { x: 0.6, y: 0.1, z: 0.15 }
}

object "flipper_pivot_left" @glowing {
  geometry: "cylinder"
  color: "#ffd700"
  position: { x: -0.75, y: 0.25, z: 2.2 }
  scale: { x: 0.08, y: 0.15, z: 0.08 }
  emissive: "#ffd700"
  emissiveIntensity: 0.8
}

object "flipper_pivot_right" @glowing {
  geometry: "cylinder"
  color: "#ffd700"
  position: { x: 0.75, y: 0.25, z: 2.2 }
  scale: { x: 0.08, y: 0.15, z: 0.08 }
  emissive: "#ffd700"
  emissiveIntensity: 0.8
}

orb "pinball" {
  geometry: "sphere"
  color: "#c0c0c0"
  position: { x: 1.5, y: 0.3, z: 2 }
  scale: { x: 0.12, y: 0.12, z: 0.12 }
}

object "bumper_1" @glowing {
  geometry: "cylinder"
  color: "#00ffff"
  position: { x: 0, y: 0.3, z: -1.2 }
  scale: { x: 0.25, y: 0.2, z: 0.25 }
  emissive: "#00ffff"
  emissiveIntensity: 0.6
}

object "bumper_2" @glowing {
  geometry: "cylinder"
  color: "#ff00ff"
  position: { x: -0.5, y: 0.3, z: -0.6 }
  scale: { x: 0.25, y: 0.2, z: 0.25 }
  emissive: "#ff00ff"
  emissiveIntensity: 0.6
}

object "bumper_3" @glowing {
  geometry: "cylinder"
  color: "#ffff00"
  position: { x: 0.5, y: 0.3, z: -0.6 }
  scale: { x: 0.25, y: 0.2, z: 0.25 }
  emissive: "#ffff00"
  emissiveIntensity: 0.6
}

object "bumper_top_1" @glowing {
  geometry: "cylinder"
  color: "#ffffff"
  position: { x: 0, y: 0.42, z: -1.2 }
  scale: { x: 0.2, y: 0.05, z: 0.2 }
  emissive: "#00ffff"
  emissiveIntensity: 1
}

object "bumper_top_2" @glowing {
  geometry: "cylinder"
  color: "#ffffff"
  position: { x: -0.5, y: 0.42, z: -0.6 }
  scale: { x: 0.2, y: 0.05, z: 0.2 }
  emissive: "#ff00ff"
  emissiveIntensity: 1
}

object "bumper_top_3" @glowing {
  geometry: "cylinder"
  color: "#ffffff"
  position: { x: 0.5, y: 0.42, z: -0.6 }
  scale: { x: 0.2, y: 0.05, z: 0.2 }
  emissive: "#ffff00"
  emissiveIntensity: 1
}

object "target_1" @glowing {
  geometry: "cube"
  color: "#4ecdc4"
  position: { x: -1.2, y: 0.3, z: -1.8 }
  scale: { x: 0.08, y: 0.25, z: 0.3 }
  emissive: "#4ecdc4"
  emissiveIntensity: 0.4
}

object "target_2" @glowing {
  geometry: "cube"
  color: "#4ecdc4"
  position: { x: -1.2, y: 0.3, z: -1.4 }
  scale: { x: 0.08, y: 0.25, z: 0.3 }
  emissive: "#4ecdc4"
  emissiveIntensity: 0.4
}

object "target_3" @glowing {
  geometry: "cube"
  color: "#4ecdc4"
  position: { x: -1.2, y: 0.3, z: -1 }
  scale: { x: 0.08, y: 0.25, z: 0.3 }
  emissive: "#4ecdc4"
  emissiveIntensity: 0.4
}

object "spinner" {
  geometry: "cube"
  color: "#9b59b6"
  position: { x: 1.2, y: 0.3, z: -1.5 }
  scale: { x: 0.02, y: 0.25, z: 0.3 }
}

object "plunger_wall" {
  geometry: "cube"
  color: "#333333"
  position: { x: 1.55, y: 0.3, z: 1 }
  scale: { x: 0.05, y: 0.3, z: 2.5 }
}

object "plunger" {
  geometry: "cylinder"
  color: "#ff4444"
  position: { x: 1.65, y: 0.25, z: 2.5 }
  scale: { x: 0.1, y: 0.3, z: 0.1 }
}

object "ramp_left" {
  geometry: "cube"
  color: "#2ecc71"
  position: { x: -1, y: 0.25, z: 0.5 }
  scale: { x: 0.6, y: 0.08, z: 1.2 }
}

object "ramp_right" {
  geometry: "cube"
  color: "#e74c3c"
  position: { x: 1, y: 0.25, z: 0.5 }
  scale: { x: 0.6, y: 0.08, z: 1.2 }
}

object "slingshot_left" {
  geometry: "cube"
  color: "#f39c12"
  position: { x: -1, y: 0.25, z: 1.8 }
  scale: { x: 0.5, y: 0.15, z: 0.08 }
}

object "slingshot_right" {
  geometry: "cube"
  color: "#f39c12"
  position: { x: 1, y: 0.25, z: 1.8 }
  scale: { x: 0.5, y: 0.15, z: 0.08 }
}

object "score_board" @glowing {
  geometry: "cube"
  color: "#111111"
  position: { x: 0, y: 0.6, z: -2.7 }
  scale: { x: 2, y: 0.4, z: 0.1 }
  emissive: "#222222"
  emissiveIntensity: 0.3
}
`;

      function init() {
        const canvas = document.getElementById('canvas');
        const container = document.getElementById('container');

        clock = new THREE.Clock();
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0x0a0a1a);
        scene.fog = new THREE.Fog(0x0a0a1a, 10, 40);

        camera = new THREE.PerspectiveCamera(
          50,
          container.clientWidth / container.clientHeight,
          0.1,
          1000
        );
        camera.position.set(0, 8, 6);
        camera.lookAt(0, 0, 0);

        renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
        renderer.setSize(container.clientWidth, container.clientHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;

        controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;
        controls.maxPolarAngle = Math.PI / 2.2;
        controls.minDistance = 4;
        controls.maxDistance = 15;

        // Lights
        const ambient = new THREE.AmbientLight(0x404060, 0.5);
        scene.add(ambient);

        const keyLight = new THREE.DirectionalLight(0xffffff, 1.5);
        keyLight.position.set(5, 10, 5);
        keyLight.castShadow = true;
        keyLight.shadow.mapSize.width = 2048;
        keyLight.shadow.mapSize.height = 2048;
        scene.add(keyLight);

        const fillLight = new THREE.PointLight(0x4ecdc4, 0.8, 20);
        fillLight.position.set(-3, 5, 3);
        scene.add(fillLight);

        const rimLight = new THREE.PointLight(0xff6b6b, 0.6, 20);
        rimLight.position.set(3, 5, -3);
        scene.add(rimLight);

        // Parse and render scene
        parseHoloScript(PINBALL_SCENE);

        document.getElementById('stat-objects').textContent = objects.length;

        window.addEventListener('resize', onResize);
        setupControls();
        animate();
      }

      function parseHoloScript(code) {
        const lines = code.split('\n');
        let currentObject = null;

        for (const line of lines) {
          const trimmed = line.trim();
          if (!trimmed || trimmed.startsWith('//')) continue;

          // Match object/orb declarations
          const objMatch = trimmed.match(/^(object|orb)\s+"([^"]+)"(?:\s+(@\w+))?/);
          if (objMatch) {
            if (currentObject) createMesh(currentObject);
            currentObject = {
              type: objMatch[1],
              name: objMatch[2],
              traits: objMatch[3] ? [objMatch[3]] : [],
              position: { x: 0, y: 0, z: 0 },
              scale: { x: 1, y: 1, z: 1 },
              rotation: { x: 0, y: 0, z: 0 },
            };
            continue;
          }

          // Parse additional traits on same line
          const traitMatch = trimmed.match(/@(\w+)/g);
          if (traitMatch && currentObject) {
            currentObject.traits.push(...traitMatch);
          }

          if (currentObject) {
            // Parse properties
            const propMatch = trimmed.match(/^(\w+):\s*(.+)/);
            if (propMatch) {
              const [, key, value] = propMatch;
              try {
                if (value.startsWith('{')) {
                  currentObject[key] = JSON.parse(value.replace(/(\w+):/g, '"$1":'));
                } else if (value.startsWith('"')) {
                  currentObject[key] = value.replace(/"/g, '');
                } else {
                  currentObject[key] = parseFloat(value) || value;
                }
              } catch (e) {
                currentObject[key] = value;
              }
            }
          }
        }
        if (currentObject) createMesh(currentObject);
      }

      function createMesh(obj) {
        let geometry;
        const geo = obj.geometry || 'cube';

        switch (geo) {
          case 'sphere':
            geometry = new THREE.SphereGeometry(0.5, 32, 32);
            break;
          case 'cylinder':
            geometry = new THREE.CylinderGeometry(0.5, 0.5, 1, 32);
            break;
          case 'torus':
            geometry = new THREE.TorusGeometry(0.5, 0.15, 16, 48);
            break;
          default:
            geometry = new THREE.BoxGeometry(1, 1, 1);
        }

        const color = new THREE.Color(obj.color || '#ffffff');
        const isGlowing = obj.traits?.some((t) => t.includes('glowing'));

        const material = new THREE.MeshStandardMaterial({
          color,
          metalness: obj.material === 'metal' ? 0.9 : 0.3,
          roughness: obj.material === 'metal' ? 0.1 : 0.6,
          emissive: isGlowing
            ? new THREE.Color(obj.emissive || obj.color)
            : new THREE.Color(0x000000),
          emissiveIntensity: obj.emissiveIntensity || (isGlowing ? 0.5 : 0),
        });

        const mesh = new THREE.Mesh(geometry, material);
        mesh.position.set(obj.position.x, obj.position.y, obj.position.z);
        mesh.scale.set(obj.scale.x, obj.scale.y, obj.scale.z);
        if (obj.rotation) {
          mesh.rotation.set(
            (obj.rotation.x * Math.PI) / 180,
            (obj.rotation.y * Math.PI) / 180,
            (obj.rotation.z * Math.PI) / 180
          );
        }
        mesh.castShadow = true;
        mesh.receiveShadow = true;
        mesh.userData.name = obj.name;

        scene.add(mesh);
        objects.push(mesh);

        // Store references to interactive objects
        if (obj.name === 'flipper_left') leftFlipper = mesh;
        if (obj.name === 'flipper_right') rightFlipper = mesh;
        if (obj.name === 'pinball') ball = mesh;
        if (obj.name === 'plunger') plunger = mesh;

        // Animate bumpers
        if (obj.name?.includes('bumper') && !obj.name.includes('top')) {
          animatedObjects.push({ mesh, type: 'pulse', speed: 2 + Math.random() });
        }
      }

      function setupControls() {
        document.addEventListener('keydown', (e) => {
          if (e.key === 'a' || e.key === 'A' || e.key === 'ArrowLeft') {
            leftFlipperActive = true;
            document.getElementById('key-a').classList.add('active');
          }
          if (e.key === 'd' || e.key === 'D' || e.key === 'ArrowRight') {
            rightFlipperActive = true;
            document.getElementById('key-d').classList.add('active');
          }
          if (e.key === ' ') {
            e.preventDefault();
            launchBall();
          }
          if (e.key === 'r' || e.key === 'R') {
            camera.position.set(0, 8, 6);
            controls.reset();
          }
        });

        document.addEventListener('keyup', (e) => {
          if (e.key === 'a' || e.key === 'A' || e.key === 'ArrowLeft') {
            leftFlipperActive = false;
            document.getElementById('key-a').classList.remove('active');
          }
          if (e.key === 'd' || e.key === 'D' || e.key === 'ArrowRight') {
            rightFlipperActive = false;
            document.getElementById('key-d').classList.remove('active');
          }
        });

        document.getElementById('launch-btn').onclick = launchBall;
      }

      function launchBall() {
        if (!ball || ballLaunched) return;

        // Reset ball position and launch
        ball.position.set(1.5, 0.3, 2);
        ballVelocity = { x: (Math.random() - 0.5) * 0.5, y: 0, z: -4 - Math.random() * 2 };
        ballLaunched = true;

        // Animate plunger
        if (plunger) {
          const originalY = plunger.position.y;
          plunger.position.y -= 0.1;
          setTimeout(() => {
            plunger.position.y = originalY;
          }, 100);
        }
      }

      function updateScore(points) {
        score += points;
        document.getElementById('score-display').textContent = score.toString().padStart(5, '0');
      }

      function onResize() {
        const container = document.getElementById('container');
        camera.aspect = container.clientWidth / container.clientHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(container.clientWidth, container.clientHeight);
      }

      function animate() {
        requestAnimationFrame(animate);
        const delta = clock.getDelta();
        const elapsed = clock.getElapsedTime();

        // Update FPS counter
        frameCount++;
        if (elapsed - lastFpsUpdate > 0.5) {
          document.getElementById('stat-fps').textContent = Math.round(
            frameCount / (elapsed - lastFpsUpdate)
          );
          frameCount = 0;
          lastFpsUpdate = elapsed;
        }

        // Flipper animations
        if (leftFlipper) {
          const targetRotation = leftFlipperActive ? 0.5 : 0.26; // ~30Â° or ~15Â°
          leftFlipper.rotation.y += (targetRotation - leftFlipper.rotation.y) * 0.3;
        }
        if (rightFlipper) {
          const targetRotation = rightFlipperActive ? -0.5 : -0.26;
          rightFlipper.rotation.y += (targetRotation - rightFlipper.rotation.y) * 0.3;
        }

        // Ball physics (simplified)
        if (ball && ballLaunched) {
          // Apply gravity (table is tilted)
          ballVelocity.z += 0.8 * delta;

          // Apply friction
          ballVelocity.x *= 0.995;
          ballVelocity.z *= 0.998;

          // Move ball
          ball.position.x += ballVelocity.x * delta * 60;
          ball.position.z += ballVelocity.z * delta * 60;

          // Wall collisions
          if (ball.position.x < -1.7) {
            ball.position.x = -1.7;
            ballVelocity.x = Math.abs(ballVelocity.x) * 0.8;
            updateScore(10);
          }
          if (ball.position.x > 1.7) {
            ball.position.x = 1.7;
            ballVelocity.x = -Math.abs(ballVelocity.x) * 0.8;
            updateScore(10);
          }
          if (ball.position.z < -2.7) {
            ball.position.z = -2.7;
            ballVelocity.z = Math.abs(ballVelocity.z) * 0.8;
            updateScore(50);
          }

          // Bumper collisions
          const bumperPositions = [
            { x: 0, z: -1.2, points: 100 },
            { x: -0.5, z: -0.6, points: 100 },
            { x: 0.5, z: -0.6, points: 100 },
          ];
          for (const bumper of bumperPositions) {
            const dx = ball.position.x - bumper.x;
            const dz = ball.position.z - bumper.z;
            const dist = Math.sqrt(dx * dx + dz * dz);
            if (dist < 0.35) {
              const angle = Math.atan2(dz, dx);
              ballVelocity.x = Math.cos(angle) * 2;
              ballVelocity.z = Math.sin(angle) * 2;
              updateScore(bumper.points);
            }
          }

          // Flipper interactions
          if (
            leftFlipperActive &&
            ball.position.z > 2 &&
            ball.position.z < 2.4 &&
            ball.position.x > -0.9 &&
            ball.position.x < -0.1
          ) {
            ballVelocity.z = -3 - Math.random();
            ballVelocity.x = 0.5 + Math.random() * 0.5;
            updateScore(25);
          }
          if (
            rightFlipperActive &&
            ball.position.z > 2 &&
            ball.position.z < 2.4 &&
            ball.position.x < 0.9 &&
            ball.position.x > 0.1
          ) {
            ballVelocity.z = -3 - Math.random();
            ballVelocity.x = -0.5 - Math.random() * 0.5;
            updateScore(25);
          }

          // Ball lost
          if (ball.position.z > 3) {
            ballLaunched = false;
            ballsRemaining--;

            const ballIndicators = document.querySelectorAll('.ball-indicator');
            if (ballsRemaining >= 0 && ballIndicators[2 - ballsRemaining]) {
              ballIndicators[2 - ballsRemaining].classList.add('used');
            }

            if (ballsRemaining <= 0) {
              // Game over - reset
              setTimeout(() => {
                score = 0;
                ballsRemaining = 3;
                document.getElementById('score-display').textContent = '00000';
                document
                  .querySelectorAll('.ball-indicator')
                  .forEach((b) => b.classList.remove('used'));
              }, 2000);
            }

            ball.position.set(1.5, 0.3, 2);
            ballVelocity = { x: 0, y: 0, z: 0 };
          }
        }

        // Animate bumpers
        animatedObjects.forEach((item) => {
          const scale = 1 + Math.sin(elapsed * item.speed * 3) * 0.1;
          item.mesh.scale.y = 0.2 * scale;
        });

        controls.update();
        renderer.render(scene, camera);
      }

      init();
    </script>
  </body>
</html>
